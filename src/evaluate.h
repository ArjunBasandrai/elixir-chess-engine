#pragma once

#include "board/board.h"

namespace elixir {
    constexpr inline EvalScore S(Score o_score, Score e_score) {
        return static_cast<EvalScore>(((I32) e_score << 16) + (I32) o_score);
    }

    constexpr inline Score O(EvalScore score) {
        return static_cast<Score>((I16) score);
    }

    constexpr inline Score E(EvalScore score) {
        return static_cast<Score>((I16) ((score + 0x8000) >> 16));
    }

    namespace eval {
        constexpr int piece_values[7] = {100, 300, 350, 500, 900, 20000, 0};
        constexpr EvalScore material_score[7] = {S(78, 112), S(282, 345), S(295, 339), S(390, 612), S(753, 1142), S(0, 0), S(0, 0)};
        constexpr EvalScore psqt[6][64] = {
            {
                S(0, 0), S(0, 0), S(0, 0), S(0, 0), S(0, 0), S(0, 0), S(0, 0), S(0, 0), 
                S(54, 164), S(76, 157), S(54, 157), S(83, 110), S(67, 106), S(51, 116), S(-13, 160), 
                S(-38, 174), S(-21, 107), S(-8, 115), S(23, 81), S(28, 61), S(32, 52), S(53, 38), 
                S(33, 84), S(-7, 82), S(-36, 39), S(-12, 29), S(-9, 9), S(-7, 1), S(13, -7), 
                S(4, -4), S(9, 14), S(-14, 14), S(-46, 15), S(-20, 12), S(-21, -4), S(-5, -7), 
                S(-5, -9), S(-12, -7), S(-4, 3), S(-25, -3), S(-47, 9), S(-24, 11), S(-24, -5), 
                S(-23, 6), S(-8, 0), S(-19, -3), S(9, 1), S(-19, -7), S(-47, 14), S(-23, 15), 
                S(-27, 1), S(-37, 7), S(-18, 12), S(-3, 1), S(18, 0), S(-26, -6), S(0, 0), 
                S(0, 0), S(0, 0), S(0, 0), S(0, 0), S(0, 0), S(0, 0), S(0, 0)
            }, 
            {
                S(-160, -87), S(-128, -28), S(-66, -15), S(-34, -22), S(-4, -19), S(-58, -42), S(-111, -21), S(-106, -109), 
                S(-31, -35), S(-14, -14), S(9, -7), S(26, -7), S(10, -15), S(70, -29), S(-15, -18), 
                S(6, -50), S(-17, -19), S(15, -4), S(32, 10), S(43, 11), S(79, -3), S(80, -8), 
                S(38, -14), S(8, -29), S(-21, -8), S(-8, 11), S(15, 22), S(35, 24), S(18, 25), 
                S(42, 19), S(1, 10), S(11, -16), S(-33, -7), S(-18, 1), S(-5, 24), S(-3, 24), 
                S(4, 27), S(0, 17), S(-1, 3), S(-23, -16), S(-51, -23), S(-30, -4), S(-17, 4), 
                S(-14, 17), S(-3, 16), S(-13, 0), S(-9, -10), S(-36, -21), S(-64, -32), S(-53, -16), 
                S(-37, -7), S(-25, -4), S(-24, -5), S(-22, -9), S(-35, -25), S(-38, -21), S(-105, -38), 
                S(-54, -51), S(-67, -22), S(-53, -19), S(-49, -18), S(-36, -29), S(-52, -44), S(-77, -50)
            }, 
            {
                S(-25, 5), S(-43, 16), S(-32, 14), S(-72, 27), S(-61, 21), S(-44, 11), S(-15, 5), S(-52, 3), 
                S(-9, -6), S(13, 11), S(7, 15), S(-8, 18), S(19, 10), S(18, 8), S(10, 16), 
                S(0, -8), S(0, 21), S(22, 16), S(23, 26), S(46, 15), S(32, 21), S(63, 21), 
                S(40, 15), S(28, 14), S(-8, 17), S(5, 32), S(26, 27), S(36, 40), S(33, 33), 
                S(29, 30), S(6, 30), S(-7, 17), S(-14, 13), S(-1, 30), S(4, 37), S(23, 34), 
                S(20, 34), S(6, 32), S(-1, 27), S(-6, 3), S(-4, 12), S(2, 22), S(2, 30), 
                S(5, 30), S(6, 33), S(1, 30), S(4, 13), S(7, 2), S(-2, 6), S(0, 7), 
                S(9, 5), S(-10, 20), S(-3, 22), S(8, 10), S(14, 13), S(2, -11), S(-23, -9), 
                S(-3, 7), S(-18, -10), S(-27, 10), S(-22, 6), S(-23, 7), S(0, -6), S(-12, -21)
            }, 
            {
                S(12, 16), S(3, 23), S(10, 32), S(15, 28), S(33, 19), S(49, 9), S(32, 11), S(51, 6), 
                S(-5, 16), S(-6, 28), S(11, 32), S(31, 23), S(17, 23), S(45, 9), S(32, 5), 
                S(62, -7), S(-25, 16), S(-5, 19), S(-3, 21), S(0, 19), S(26, 6), S(27, 0), 
                S(64, -7), S(42, -12), S(-41, 18), S(-28, 17), S(-25, 26), S(-17, 22), S(-11, 8), 
                S(-11, 2), S(-3, 0), S(0, -6), S(-59, 11), S(-57, 16), S(-47, 18), S(-35, 17), 
                S(-35, 13), S(-50, 11), S(-27, -1), S(-35, -5), S(-65, 7), S(-56, 7), S(-48, 7), 
                S(-49, 11), S(-43, 7), S(-46, 0), S(-13, -19), S(-33, -19), S(-68, 2), S(-57, 6), 
                S(-42, 7), S(-45, 9), S(-41, 0), S(-39, -2), S(-23, -12), S(-51, -6), S(-50, -1), 
                S(-49, 7), S(-39, 14), S(-34, 13), S(-30, 5), S(-40, 1), S(-26, -2), S(-48, -10)
            }, 
            {
                S(-36, 38), S(-29, 51), S(0, 67), S(32, 54), S(33, 51), S(37, 45), S(55, 2), S(3, 32), 
                S(0, 3), S(-21, 46), S(-15, 79), S(-22, 96), S(-16, 113), S(19, 73), S(0, 57), 
                S(41, 33), S(0, 15), S(-2, 32), S(-4, 72), S(11, 74), S(16, 88), S(56, 68), 
                S(57, 32), S(54, 20), S(-16, 25), S(-12, 47), S(-8, 61), S(-9, 84), S(-7, 97), 
                S(5, 83), S(4, 68), S(10, 48), S(-14, 21), S(-16, 50), S(-17, 59), S(-9, 78), 
                S(-10, 76), S(-11, 68), S(0, 48), S(2, 36), S(-17, 11), S(-9, 27), S(-15, 49), 
                S(-15, 48), S(-13, 51), S(-6, 42), S(5, 21), S(0, 9), S(-18, 6), S(-13, 10), 
                S(-3, 7), S(-4, 17), S(-5, 20), S(2, -5), S(8, -33), S(19, -62), S(-20, 0), 
                S(-30, 7), S(-24, 10), S(-9, 2), S(-17, 6), S(-30, 5), S(-8, -23), S(-15, -23)
            }, 
            {
                S(42, -89), S(18, -40), S(51, -30), S(-87, 17), S(-32, -1), S(16, 0), S(64, -6), S(166, -110), 
                S(-72, 1), S(-34, 29), S(-77, 42), S(27, 24), S(-24, 44), S(-18, 55), S(20, 45), 
                S(0, 15), S(-94, 16), S(6, 34), S(-59, 53), S(-77, 63), S(-38, 62), S(35, 55), 
                S(16, 54), S(-19, 26), S(-61, 6), S(-72, 40), S(-87, 57), S(-131, 70), S(-118, 69), 
                S(-81, 63), S(-81, 55), S(-104, 30), S(-56, -4), S(-65, 25), S(-94, 48), S(-121, 62), 
                S(-118, 62), S(-82, 49), S(-87, 38), S(-109, 21), S(-13, -14), S(1, 7), S(-53, 28), 
                S(-65, 40), S(-59, 39), S(-57, 31), S(-12, 12), S(-29, 0), S(72, -36), S(32, -9), 
                S(19, 2), S(-14, 13), S(-15, 16), S(2, 7), S(48, -10), S(57, -28), S(68, -70), 
                S(91, -51), S(65, -32), S(-31, -14), S(31, -39), S(-7, -16), S(72, -42), S(73, -69)
            }
        };

        const int knight_mobility[9] = {S(-13, -26), S(16, 17), S(31, 14), S(35, 11), S(44, 7), S(49, 4), S(53, 1), S(55, 0), S(69, -12)};
        const int bishop_mobility[14] = {S(-30, -30), S(-9, -33), S(6, -42), S(23, -22), S(30, -16), S(37, -7), S(46, 1), S(52, 9), S(62, 13), S(61, 19), S(69, 25), S(80, 17), S(77, 24), S(101, 14)};
        const int rook_mobility[15] = {S(-30, -35), S(-25, -20), S(-6, 0), S(6, 2), S(9, 14), S(17, 13), S(18, 23), S(24, 26), S(34, 25), S(37, 30), S(49, 29), S(58, 30), S(63, 34), S(84, 39), S(97, 31)};
        const int queen_mobility[28] = {S(0, 0), S(0, 0), S(0, 0), S(-231, 4), S(-210, 202), S(0, -92), S(7, -172), S(8, -105), S(6, -78), S(13, -62), S(14, -67), S(13, -38), S(17, -21), S(21, -18), S(24, -8), S(31, -12), S(33, -2), S(31, 9), S(35, 18), S(37, 22), S(42, 20), S(40, 32), S(38, 42), S(44, 33), S(51, 31), S(85, 15), S(9, 61), S(304, -89)};

        Phase get_game_phase(Board &board, int game_phase_score);
        int evaluate(Board& board);
        Score interpolate_eval(EvalScore score, Board &board);
    }
}